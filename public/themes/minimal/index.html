{% extends settings.theme ~ "/layout.html" %}

{% block title %}Index{% endblock %}

{% set nbPosts = 0 %}

{% block content %}
	{% for article in articles %}
		{% if nbPosts < settings.displayedPosts %}
			{% if 'This is a cross post' not in article.body or 'This is a cross post' in article.body and settings.crosspost == true %}
				{% set nbPosts = nbPosts + 1 %}
				<article data-json="{{ article.json_metadata }}">
					<a href="{{ url_for('post', { 'permlink': article.permlink }) }}">
						<h2>{{ article.title }}</h2>
						<img src="" alt="Picture of post : {{ article.title }}" class="img-article">
					</a>
					<p>{{ article.created|date("m/d/Y") }} - {{article.active_votes|length}} Upvotes - {{article.body|split(' ')|length }} Words</p>
					{% set excerpt = article.body|striptags|slice(0,100) %}
					<p>{{ excerpt }}...</p>
				</article>
				<hr>
			{% endif %}
		{% endif %}
	{% endfor %}

	<div>
		<a class="button" href="https://peakd.com/@{{ settings.author }}">See my older posts on PeakD</a>
	</div>

{% endblock %}

{% block scripts %}
<script>
  $(function() {
  	$(".excerpt").each(function (){
			text = $(this).text();
			text = text.replace(/!\[[^\]]*\]\((.*?)\s*("(?:.*[^"])")?\s*\)/g, '');
			text = marked.parse(text);
			$(this).html(text);
		});

  	$("article").each(function (){
  		metadata = $(this).data('json');
  		if (metadata.image == null) {
  			head = "/themes/{{ settings.theme }}/no-img.png"
  		} else {
  			head = metadata.image[0];
  		}
  		img = $(this).find('.img-article');
  		img.attr('src', head);
  	});
  });
</script>
{% endblock %}
